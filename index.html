<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Input Form</title>
    <link rel="icon" href="/icon.png" type="image">
    <link rel="stylesheet" href="styles.css">
</head>

<body>

    <form id="myForm" onsubmit="submitForm(event)" method="post">
        <h1>Churn Prediction</h1>
        <img class="credit-card-image" src="/credit-card.webp" alt="Credit Card Image">
        <p class="form-description">Fill out the form below to check if the customer will exit the bank or not.</p>

        <label for="customer_id">Customer ID:</label>
        <input type="text" id="customer_id" name="customer_id" placeholder="Enter Customer ID" required>

        <label for="surname">Surname:</label>
        <input type="text" id="surname" name="surname" placeholder="Enter Surname" required>

        <label for="credit_score">Credit Score:</label>
        <input type="number" id="credit_score" name="credit_score" placeholder="Enter Credit Score" required>

        <label for="tenure">Tenure:</label>
        <input type="number" id="tenure" name="tenure" placeholder="Enter Tenure (in years)" required>

        <label for="do_have_credit_card">Do you have a Credit Card?</label>
        <div class="radio-group">
            <input type="radio" id="credit_card_yes" name="do_have_credit_card" value="1" required>
            <label class="radio-label" for="credit_card_yes">Yes</label>
            <input type="radio" id="credit_card_no" name="do_have_credit_card" value="0">
            <label class="radio-label" for="credit_card_no">No</label>
        </div>

        <label for="salary">Salary:</label>
        <input type="number" id="salary" name="salary" placeholder="Enter Salary" required>

        <label for="gender">Gender:</label>
        <select name="gender" id="gender" required>
            <option value="" disabled selected>Select</option>
            <option value="male">Male</option>
            <option value="female">Female</option>
        </select>

        <label for="age">Age:</label>
        <input type="number" id="age" name="age" placeholder="Enter Age" required>

        <label for="balance">Balance in Savings Account:</label>
        <input type="number" id="balance" name="balance" placeholder="Enter Balance" required>

        <label for="num_of_products">Number of Products:</label>
        <input type="number" id="num_of_products" name="num_of_products" placeholder="Enter Number of Products"
            required>

        <label for="is_active_member">Is Active Member:</label>
        <div class="radio-group">
            <input type="radio" id="is_active_member_yes" name="is_active_member" value="1" required>
            <label class="radio-label" for="is_active_member_yes">Yes</label>
            <input type="radio" id="is_active_member_no" name="is_active_member" value="0">
            <label class="radio-label" for="is_active_member_no">No</label>
        </div>

        <label for="geography">Geography:</label>
        <select name="geography" id="geography" required>
            <option value="" disabled selected>Select</option>
            <option value="germany">Germany</option>
            <option value="france">France</option>
            <option value="spain">Spain</option>
        </select>

        <div id="loader-container">
            <div id="loader" class="loader"></div>
        </div>

        <input type="submit" value="Submit">
    </form>

    <script>
        function submitForm(event) {
            event.preventDefault(); // Prevent default form submission

            // Show loader
            document.getElementById("loader-container").style.display = "block";

            // Gather form data
            let formData = {};
            const formElements = document.getElementById("myForm").elements;
            for (let i = 0; i < formElements.length; i++) {
                const element = formElements[i];
                if (element.tagName === "SELECT" || element.tagName === "INPUT") {
                    formData[element.name] = element.value;
                }
            }

            // Converting form data to JSON format
            const jsonData = JSON.stringify(formData);

            // Make API request
            fetch('https://credit-rating-api.onrender.com/predict', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: jsonData
            })
                .then(response => response.json())
                .then(data => {
                    // Redirecting to new page with form data and API response as URL parameters
                    const queryParams = new URLSearchParams();
                    queryParams.append('formData', JSON.stringify(formData));
                    queryParams.append('apiResponse', JSON.stringify(data));
                    window.location.href = 'result.html?' + queryParams.toString();
                })
                .catch(error => {
                    console.error("Error:", error);
                })
                .finally(() => {
                    // Hide loader regardless of success or failure
                    document.getElementById("loader-container").style.display = "none";
                });

        }

        // Default request to API so that the the server is started for main request to API
        document.addEventListener('DOMContentLoaded', function () {
            fetch('https://credit-rating-api.onrender.com/predict', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    "chk_acct": 0,
                    "duration": 0,
                    "history": 0,
                    "purpose_of_credit": 0,
                    "credit_amount": 0,
                    "balance": 0,
                    "employment": 0,
                    "install_rate": 0,
                    "marital_status": 0,
                    "real_estate": 0,
                    "age": 0,
                    "other_installment": 0,
                    "num_credits": 0,
                    "job": 0,
                    "phone": 0,
                    "foreign": 0
                })
            })
                .then(response => {
                    if (!response.ok) {
                        console.error('Failed to send default request to API:', response.status, response.statusText);
                    } else {
                        console.log('Default request sent successfully to API.');
                    }
                })
                .catch(error => {
                    console.error('Error sending default request to API:', error);
                });
        });
    </script>
</body>

</html>